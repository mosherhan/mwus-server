<!DOCTYPE html>
<html lang="en">

<head>
    <!--
      Founders-only Project Management Dashboard
      Single file (HTML + CSS + JS). Uses Firebase (Auth + Firestore, modular v9+).

      Setup instructions:
      1) Create a Firebase project, enable Email/Password authentication, create founder accounts.
      2) Create a Firestore database (in production or test as you prefer).
      3) Replace the firebaseConfig object in the JS section with your project's values.
      4) Optionally configure Firestore Security Rules to restrict to founders.

      Collections used:
        - projects: { name, price, division, status, createdAt }
        - goals: { text, createdAt }
        - developers: { name, role, contact, createdAt }
    -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Management · Dashboard</title>

    <!-- Typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;400;500;600&display=swap"
        rel="stylesheet">

    <style>
        /*
        ==========================
        Base: Aesthetic + Resets
        ==========================
      */
        :root {
            --bg: #0c0c0c;
            --panel: #121212;
            --panel-2: #141414;
            --panel-3: #151515;
            --text: #eaeaea;
            --muted: #9a9aa3;
            --accent: #a0c9ff;
            --accent-2: #b8b6ff;
            --ok: #64e0a0;
            --warn: #ffd166;
            --danger: #ff6b6b;
            --ring: rgba(160, 201, 255, 0.25);
            --shadow-soft: 0 8px 24px rgba(0, 0, 0, 0.35);
            --radius: 18px;
            --radius-sm: 12px;
            --border: #1e1e1e;
        }

        * {
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
        }

        body {
            margin: 0;
            background: var(--bg);
            color: var(--text);
            font-family: -apple-system, system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Heading type uses Helvetica stack */
        h1,
        h2,
        h3,
        .display {
            font-family: "Helvetica Neue", Helvetica, Arial, -apple-system, system-ui, sans-serif;
            letter-spacing: -0.01em;
        }

        h1 {
            font-size: clamp(36px, 5vw, 64px);
            line-height: 1.05;
            margin: 6px 0 18px;
            font-weight: 700;
        }

        h2 {
            font-size: 24px;
            line-height: 1.15;
            margin: 0 0 10px;
            font-weight: 700;
        }

        h3 {
            font-size: 18px;
            line-height: 1.2;
            margin: 0 0 12px;
            font-weight: 700;
        }


        a {
            color: inherit;
            text-decoration: none;
        }

        button,
        input,
        textarea,
        select {
            font: inherit;
            color: inherit;
        }

        input,
        textarea,
        select {
            background: transparent;
        }

        /*
        ==========================
        Layout: App Shell
        ==========================
      */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 24px 64px;
        }

        .topbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 22px;
        }

        .brand {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            user-select: none;
        }

        .brand-badge {
            width: 30px;
            height: 30px;
            border-radius: 8px;
            background: var(--panel-3);
            display: grid;
            place-items: center;
            border: 1px solid var(--border);
        }

        .brand-title {
            font-weight: 700;
            letter-spacing: 0.02em;
        }

        .logout-btn {
            padding: 10px 14px;
            border-radius: 12px;
            background: var(--panel);
            border: 1px solid #24242a;
            transition: transform .12s ease, background .2s ease, box-shadow .2s ease;
            cursor: pointer;
        }

        .logout-btn:hover {
            transform: translateY(-1px);
            background: #1a1a1f;
            box-shadow: var(--shadow-soft);
        }

        /*
        ==========================
        Grid: Bento Board
        ==========================
      */
        .grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 18px;
        }

        .card {
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            box-shadow: none;
            padding: 22px;
            transition: border-color .18s ease, transform .18s ease, background .2s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            border-color: #2a2a2a;
        }

        .card h3 {
            margin: 2px 0 12px;
        }

        .muted {
            color: var(--muted);
        }

        /* spans across columns */
        .span-4 {
            grid-column: span 4;
        }

        .span-6 {
            grid-column: span 6;
        }

        .span-8 {
            grid-column: span 8;
        }

        .span-12 {
            grid-column: span 12;
        }

        /*
        ==========================
        Forms
        ==========================
      */
        .field {
            display: grid;
            gap: 8px;
            margin-bottom: 12px;
        }

        .field label {
            font-size: 12px;
            color: var(--muted);
        }

        .input,
        .select,
        .textarea {
            width: 100%;
            background: #0f0f0f;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 12px 12px;
            outline: none;
            transition: border-color .15s ease, box-shadow .15s ease, background .2s ease;
        }

        .textarea {
            min-height: 88px;
            resize: vertical;
        }

        .input:focus,
        .select:focus,
        .textarea:focus {
            border-color: #2f2f38;
            box-shadow: 0 0 0 6px var(--ring);
            background: #0f0f13;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
            background: #181818;
            border: 1px solid var(--border);
            color: var(--text);
            padding: 12px 14px;
            border-radius: 12px;
            cursor: pointer;
            transition: transform .12s ease, background .2s ease, box-shadow .2s ease;
        }

        .btn:hover {
            transform: translateY(-1px);
            background: #1f1f1f;
        }

        .btn.primary {
            background: #1d1d1d;
            border-color: #2a2a2a;
        }

        .btn.ghost {
            background: transparent;
            border-color: #2a2a33;
        }

        .btn.danger {
            border-color: #3a2a2a;
            color: #ffb3b3;
        }

        .row {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 12px;
        }

        .col-6 {
            grid-column: span 6;
        }

        .col-4 {
            grid-column: span 4;
        }

        .col-12 {
            grid-column: span 12;
        }

        /*
        ==========================
        Lists & Cards
        ==========================
      */
        .items {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 12px;
        }

        .item {
            grid-column: span 6;
            background: #101010;
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 14px;
        }

        .items {
            align-content: start;
            grid-auto-rows: auto;
        }

        .item h4 {
            margin: 4px 0 10px;
            font-size: 15px;
        }

        .status-badge {
            display: inline-grid;
            place-items: center;
            padding: 4px 8px;
            border-radius: 999px;
            font-size: 11px;
            letter-spacing: .02em;
            border: 1px solid #2c2c35;
        }

        .ongoing {
            color: #b2f5ea;
            border-color: #254e5b;
            background: #102329;
        }

        .completed {
            color: #a0f0b5;
            border-color: #24573a;
            background: #0f2418;
        }

        .inline-input {
            width: 100%;
            background: #0e0e0e;
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 8px 10px;
            margin-bottom: 8px;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border: 1px solid var(--border);
            border-radius: 999px;
            font-size: 11px;
        }

        .badge.warn {
            color: #ffd6a0;
            border-color: #3a2f12;
            background: #201708;
        }

        .badge.urgent {
            color: #ffb3b3;
            border-color: #3a1e1e;
            background: #210e0e;
        }

        .progress {
            height: 10px;
            border-radius: 999px;
            background: #0f0f0f;
            border: 1px solid var(--border);
            overflow: hidden;
            position: relative;
        }

        .progress>span {
            display: block;
            height: 100%;
            background: linear-gradient(90deg, #4f8bff, #7aa7ff);
            box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.06);
        }

        .progress .progress-label {
            position: absolute;
            top: 50%;
            right: 8px;
            transform: translateY(-50%);
            font-size: 11px;
            color: #c6c6cf;
        }

        .select[multiple] {
            min-height: 140px;
        }

        #assignDevs {
            background: #0f0f0f;
        }

        /*
        ==========================
        Auth Views
        ==========================
      */
        .auth {
            min-height: 100vh;
            display: grid;
            place-items: center;
        }

        .auth-card {
            width: 100%;
            max-width: 380px;
            padding: 26px;
            border-radius: 18px;
            background: var(--panel);
            border: 1px solid var(--border);
            box-shadow: none;
        }

        .auth-title {
            font-weight: 700;
            margin: 6px 0 18px;
        }

        .mono {
            font-family: "IBM Plex Mono", ui-monospace, Menlo, Consolas, monospace;
        }

        /*
        ==========================
        Responsive
        ==========================
      */
        @media (max-width: 1100px) {
            .span-12 {
                grid-column: span 12;
            }

            .span-8 {
                grid-column: span 12;
            }

            .span-6 {
                grid-column: span 12;
            }

            .span-4 {
                grid-column: span 12;
            }

            .items .item {
                grid-column: span 12;
            }


            .row .col-6 {
                grid-column: span 12;
            }

            .row .col-4 {
                grid-column: span 12;
            }
        }
    </style>
</head>

<body>
    <!-- ==========================
         Auth View
         ========================== -->
    <main id="auth" class="auth" aria-hidden="false">
        <section class="auth-card">
            <div class="brand" style="margin-bottom: 8px;">
                <div class="brand-badge mono">Ø</div>
                <div class="brand-title">Founders · Access</div>
            </div>
            <h2 class="auth-title">Sign in</h2>
            <div class="field">
                <label for="email">Email</label>
                <input id="email" type="email" class="input" placeholder="founder@company.com"
                    autocomplete="username" />
            </div>
            <div class="field">
                <label for="password">Password</label>
                <input id="password" type="password" class="input" placeholder="••••••••"
                    autocomplete="current-password" />
            </div>
            <button id="loginBtn" class="btn primary" style="width: 100%; margin-top: 6px;">Sign in</button>
            <p class="muted mono" style="font-size: 12px; margin-top: 12px;">Email/password only. No sign‑ups here.</p>
            <p id="authError" class="mono"
                style="color: var(--danger); font-size: 12px; margin-top: 10px; display: none;"></p>
        </section>
    </main>

    <!-- ==========================
         Dashboard View
         ========================== -->
    <div id="app" class="container" style="display:none;" aria-hidden="true">
        <header class="topbar">
            <div class="brand">
                <div class="brand-badge mono"><img src="../mwslogo.png"></div>
                <div class="brand-title">Management Dashboard</div>
                <span class="muted mono" style="font-size: 12px;">internal</span>
            </div>
            <div>
                <button id="logoutBtn" class="logout-btn">Logout</button>
            </div>
        </header>

        <section style="margin: 12px 0 26px;">
            <h1 class="display" style="margin-bottom: 6px;">Founders Dashboard</h1>
            <p class="mono muted" style="max-width: 760px; font-size: 13px; line-height: 1.6;">
                A quiet space to track projects, goals and people. Minimal. Typographic. Internal.
            </p>
        </section>

        <section class="grid" id="grid">
            <!-- Add Project -->
            <article class="card span-6" id="addProjectCard">
                <h3>Add Project</h3>
                <div class="row">
                    <div class="col-6 field">
                        <label for="projectName">Project Name</label>
                        <input id="projectName" class="input" placeholder="Website redesign" />
                    </div>
                    <div class="col-6 field">
                        <label for="projectPrice">Project Price (₹)</label>
                        <input id="projectPrice" class="input" type="number" inputmode="decimal" placeholder="20000" />
                    </div>
                    <div class="col-12 field">
                        <label for="division">Division of Money (₹)</label>
                        <input id="division" class="input" placeholder="12000 · 8000" />
                    </div>
                    <div class="col-6 field">
                        <label for="status">Status</label>
                        <select id="status" class="select">
                            <option value="ongoing">Ongoing</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>
                    <div class="col-6 field">
                        <label for="deadline">Deadline</label>
                        <input id="deadline" class="input" type="date" />
                    </div>
                    <div class="col-4 field">
                        <label for="budget">Budget (₹)</label>
                        <input id="budget" class="input" type="number" inputmode="decimal" placeholder="15000" />
                    </div>
                    <div class="col-4 field">
                        <label for="expense">Expense (₹)</label>
                        <input id="expense" class="input" type="number" inputmode="decimal" placeholder="5000" />
                    </div>
                    <div class="col-4 field">
                        <label for="revenue">Revenue (₹)</label>
                        <input id="revenue" class="input" type="number" inputmode="decimal" placeholder="20000" />
                    </div>
                    <div class="col-12 field">
                        <label for="assignDevs">Assign Developers</label>
                        <select id="assignDevs" class="select" multiple size="4"></select>
                        <span class="muted mono" style="font-size:11px;">Hold Ctrl/Cmd to multi‑select</span>
                    </div>
                    <div class="col-12 field">
                        <label for="progress">Progress</label>
                        <input id="progress" class="input" type="range" min="0" max="100" value="0" />
                    </div>
                    <div class="col-12 field">
                        <label for="projectFile">Attachment (optional)</label>
                        <input id="projectFile" class="input" type="file" />
                    </div>
                    <div class="col-12" style="display:flex; gap:10px; align-items:center;">
                        <button id="addProjectBtn" class="btn primary">Add Project</button>
                        <span id="addProjectMsg" class="muted mono" style="font-size:12px;"></span>
                    </div>
                </div>
            </article>

            <!-- Ongoing Projects -->
            <article class="card span-6" id="projectsCard">
                <div style="display:flex; align-items:center; justify-content:space-between;">
                    <h3>Ongoing Projects</h3>
                    <span class="muted mono" id="projectsCount">0</span>
                </div>
                <div style="display:flex; gap:8px; align-items:center; margin-bottom:8px;">
                    <input id="projectSearch" class="input"
                        placeholder="Search projects or filter by status: ongoing/completed" />
                    <button id="clearSearch" class="btn ghost">Clear</button>
                </div>
                <div class="items" id="projectsList"></div>
            </article>

            <!-- Future Goals -->
            <article class="card span-12" id="goalsCard">
                <h3>Future Goals</h3>
                <div class="row" style="margin-bottom: 10px; align-items:end;">
                    <div class="col-6"><input id="goalText" class="input"
                            placeholder="Ship v2, automate onboarding, ..." /></div>
                    <div class="col-4" style="display:flex; gap:8px;">
                        <button id="addGoalBtn" class="btn" style="width:100%;">Add</button>
                    </div>
                </div>
                <ul id="goalsList" class="mono"
                    style="list-style:none; padding:0; margin:0; display:grid; gap:8px; grid-auto-rows:auto;"></ul>
            </article>

            <!-- Developers Info -->
            <article class="card span-8" id="developersCard">
                <div style="display:flex; align-items:center; justify-content:space-between;">
                    <h3>Developers</h3>
                    <span class="muted mono" id="devsCount">0</span>
                </div>
                <div class="row" style="margin-bottom: 6px;">
                    <div class="col-4 field">
                        <label for="devName">Name</label>
                        <input id="devName" class="input" placeholder="Alex Doe" />
                    </div>
                    <div class="col-4 field">
                        <label for="devRole">Role</label>
                        <input id="devRole" class="input" placeholder="Frontend Engineer" />
                    </div>
                    <div class="col-4 field">
                        <label for="devContact">Contact</label>
                        <input id="devContact" class="input" placeholder="@username | email" />
                    </div>
                    <div class="col-4 field">
                        <label for="devSkills">Skills</label>
                        <input id="devSkills" class="input" placeholder="React, Node, Design Systems" />
                    </div>
                    <div class="col-4 field">
                        <label for="devNotes">Internal Notes</label>
                        <input id="devNotes" class="input" placeholder="Strong on animations" />
                    </div>
                    <div class="col-12" style="display:flex; gap:10px; align-items:center;">
                        <button id="addDevBtn" class="btn">Add Developer</button>
                        <span id="addDevMsg" class="muted mono" style="font-size:12px;"></span>
                    </div>
                </div>
                <div class="items" id="devsList"></div>
            </article>

            <!-- Analytics -->
            <article class="card span-4" id="analyticsCard">
                <h3>Analytics</h3>
                <div class="mono muted" id="analyticsText" style="font-size:13px; display:grid; gap:6px;"></div>
            </article>

            <!-- Announcements -->
            <article class="card span-12" id="notesCard">
                <div style="display:flex; align-items:center; justify-content:space-between;">
                    <h3>Announcements / Notes</h3>
                </div>
                <div style="display:flex; gap:8px; margin-bottom:10px;">
                    <input id="noteText" class="input" placeholder="Share an update for founders" />
                    <button id="addNoteBtn" class="btn">Post</button>
                </div>
                <ul id="notesList" class="mono" style="list-style:none; padding:0; margin:0; display:grid; gap:8px;">
                </ul>
            </article>
        </section>
    </div>

    <!-- ==========================
         Firebase + App Logic
         ========================== -->
    <script type="module">
        // Firebase modular SDK v9+ via CDN
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js';
        import { getFirestore, collection, addDoc, serverTimestamp, onSnapshot, query, orderBy, updateDoc, deleteDoc, doc, where } from 'https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js';
        import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.12.5/firebase-storage.js';

        // ---- Replace with your Firebase project's config ----
        const firebaseConfig = {
            apiKey: "AIzaSyC_hpImJNC4YrG3q5GhPRfRjXfYzJF-Dzk",
            authDomain: "management-8f186.firebaseapp.com",
            projectId: "management-8f186",
            storageBucket: "management-8f186.appspot.com", // corrected bucket domain
            messagingSenderId: "908972656891",
            appId: "1:908972656891:web:86910fe3fce34e91fe085e",
            measurementId: "G-9644QRM5PK"
        };

        // Initialize
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // UI Elements
        const authView = document.getElementById('auth');
        const appView = document.getElementById('app');
        const loginBtn = document.getElementById('loginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const authErrorEl = document.getElementById('authError');

        // Auth state
        onAuthStateChanged(auth, (user) => {
            if (user) {
                authView.style.display = 'none';
                authView.setAttribute('aria-hidden', 'true');
                appView.style.display = 'block';
                appView.setAttribute('aria-hidden', 'false');
            } else {
                appView.style.display = 'none';
                appView.setAttribute('aria-hidden', 'true');
                authView.style.display = 'grid';
                authView.setAttribute('aria-hidden', 'false');
            }
        });

        loginBtn.addEventListener('click', async () => {
            const email = /** @type {HTMLInputElement} */(document.getElementById('email')).value.trim();
            const password = /** @type {HTMLInputElement} */(document.getElementById('password')).value;
            authErrorEl.style.display = 'none';
            try {
                await signInWithEmailAndPassword(auth, email, password);
            } catch (err) {
                authErrorEl.textContent = err.message ?? 'Failed to sign in';
                authErrorEl.style.display = 'block';
            }
        });

        logoutBtn.addEventListener('click', async () => {
            await signOut(auth);
        });

        // ------------------------------
        // Projects
        // ------------------------------
        const projectName = document.getElementById('projectName');
        const projectPrice = document.getElementById('projectPrice');
        const division = document.getElementById('division');
        const status = document.getElementById('status');
        const addProjectBtn = document.getElementById('addProjectBtn');
        const addProjectMsg = document.getElementById('addProjectMsg');
        const projectsList = document.getElementById('projectsList');
        const projectsCount = document.getElementById('projectsCount');
        const assignDevs = document.getElementById('assignDevs');
        const progressInput = document.getElementById('progress');
        const deadlineInput = document.getElementById('deadline');
        const budgetInput = document.getElementById('budget');
        const expenseInput = document.getElementById('expense');
        const revenueInput = document.getElementById('revenue');
        const projectFileInput = document.getElementById('projectFile');
        const projectSearch = document.getElementById('projectSearch');
        const clearSearch = document.getElementById('clearSearch');

        // Populate developer multi-select
        onSnapshot(query(collection(db, 'developers'), orderBy('createdAt', 'desc')), (snap) => {
            assignDevs.innerHTML = '';
            snap.forEach((d) => {
                const dev = { id: d.id, ...d.data() };
                const opt = document.createElement('option');
                opt.value = dev.id; opt.textContent = dev.name || 'Unnamed';
                assignDevs.appendChild(opt);
            });
        });

        addProjectBtn.addEventListener('click', async () => {
            const nameVal = projectName.value.trim();
            const priceVal = Number(projectPrice.value || 0);
            const divisionVal = division.value.trim();
            const statusVal = status.value;
            const deadlineVal = deadlineInput.value || null;
            const progressVal = Number(progressInput.value || 0);
            const budgetVal = Number(budgetInput.value || 0);
            const expenseVal = Number(expenseInput.value || 0);
            const revenueVal = Number(revenueInput.value || 0);
            const profitVal = revenueVal - expenseVal;
            const assigned = Array.from(assignDevs.selectedOptions).map(o => o.value);
            if (!nameVal) { flash(addProjectMsg, 'Please enter a project name.', true); return; }
            try {
                let attachmentURL = '';
                const file = projectFileInput.files && projectFileInput.files[0];
                if (file) {
                    const sref = storageRef(storage, `projectFiles/${Date.now()}_${file.name}`);
                    await uploadBytes(sref, file);
                    attachmentURL = await getDownloadURL(sref);
                }
                await addDoc(collection(db, 'projects'), {
                    name: nameVal,
                    price: priceVal,
                    division: divisionVal,
                    status: statusVal,
                    deadline: deadlineVal,
                    progress: progressVal,
                    budget: budgetVal,
                    expense: expenseVal,
                    revenue: revenueVal,
                    profit: profitVal,
                    assignedDevelopers: assigned,
                    attachmentURL,
                    createdAt: serverTimestamp(),
                });
                projectName.value = '';
                projectPrice.value = '';
                division.value = '';
                status.value = 'ongoing';
                deadlineInput.value = '';
                progressInput.value = '0';
                budgetInput.value = '';
                expenseInput.value = '';
                revenueInput.value = '';
                projectFileInput.value = '';
                flash(addProjectMsg, 'Project added.');
            } catch (e) {
                const msg = (e && e.message) ? e.message : 'Error adding project.';
                flash(addProjectMsg, msg, true);
                console.error('addProject error:', e);
            }
        });

        let latestProjects = [];
        function renderProjects(list) {
            projectsList.innerHTML = '';
            let count = 0;
            list.forEach((p) => {
                count += 1;
                const card = document.createElement('div');
                card.className = 'item';
                const overdue = p.deadline && new Date(p.deadline) < new Date() && p.status !== 'completed';
                const progress = Math.max(0, Math.min(100, Number(p.progress || 0)));
                card.innerHTML = `
            <div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
              <h4 class="mono">${escapeHtml(p.name || '')}</h4>
              <span class="status-badge ${p.status === 'completed' ? 'completed' : 'ongoing'}">${p.status || 'ongoing'}</span>
            </div>
            <div class="mono muted" style="font-size:12px; margin-bottom:6px; display:flex; gap:8px; flex-wrap:wrap;">
              <span>₹${Number(p.price || 0).toLocaleString('en-IN')}</span>
              ${p.deadline ? `<span class="badge ${overdue ? 'urgent' : ''}">Due: ${p.deadline}</span>` : ''}
              ${p.assignedDevelopers && p.assignedDevelopers.length ? `<span class="badge">Devs: ${p.assignedDevelopers.length}</span>` : ''}
              ${typeof p.profit === 'number' ? `<span class="badge ${p.profit < 0 ? 'urgent' : ''}">Profit: ₹${Number(p.profit || 0).toLocaleString('en-IN')}</span>` : ''}
            </div>
            <input class="inline-input" data-k="name" placeholder="Name" value="${escapeAttr(p.name || '')}" />
            <div style="display:grid; grid-template-columns: repeat(12, 1fr); gap:8px;">
              <input class="inline-input" style="grid-column: span 4;" data-k="price" type="number" inputmode="decimal" placeholder="Price" value="${escapeAttr(p.price ?? '')}" />
              <input class="inline-input" style="grid-column: span 8;" data-k="division" placeholder="Division (₹)" value="${escapeAttr(p.division || '')}" />
              <select class="inline-input" style="grid-column: span 4;" data-k="status">
                <option value="ongoing" ${p.status === 'ongoing' ? 'selected' : ''}>Ongoing</option>
                <option value="completed" ${p.status === 'completed' ? 'selected' : ''}>Completed</option>
              </select>
              <input class="inline-input" style="grid-column: span 4;" data-k="deadline" type="date" value="${escapeAttr(p.deadline || '')}" />
              <input class="inline-input" style="grid-column: span 4;" data-k="progress" type="number" min="0" max="100" value="${escapeAttr(p.progress ?? 0)}" />
              <input class="inline-input" style="grid-column: span 4;" data-k="budget" type="number" placeholder="Budget (₹)" value="${escapeAttr(p.budget ?? '')}" />
              <input class="inline-input" style="grid-column: span 4;" data-k="expense" type="number" placeholder="Expense (₹)" value="${escapeAttr(p.expense ?? '')}" />
              <input class="inline-input" style="grid-column: span 4;" data-k="revenue" type="number" placeholder="Revenue (₹)" value="${escapeAttr(p.revenue ?? '')}" />
            </div>
            <div class="progress" style="margin:8px 0 6px;">
              <span style="width:${progress}%;"></span>
              <span class="progress-label">${progress}%</span>
            </div>
            <div style="display:flex; gap:8px; margin-top:8px; flex-wrap:wrap;">
              <button class="btn" data-action="save">Save</button>
              <button class="btn ghost" data-action="complete">Mark Completed</button>
              <button class="btn danger" data-action="delete">Delete</button>
              ${p.attachmentURL ? `<a class="btn ghost" href="${p.attachmentURL}" target="_blank" rel="noopener">Attachment</a>` : ''}
            </div>
          `;

                card.addEventListener('click', async (ev) => {
                    const target = ev.target;
                    if (!(target instanceof HTMLElement)) return;
                    const action = target.getAttribute('data-action');
                    if (!action) return;
                    const inputs = /** @type {NodeListOf<HTMLInputElement|HTMLSelectElement>} */(card.querySelectorAll('.inline-input'));
                    const updated = {}; inputs.forEach((el) => { const k = el.getAttribute('data-k'); if (!k) return; updated[k] = el.value; });
                    if (updated.price !== undefined) updated.price = Number(updated.price || 0);
                    ['budget', 'expense', 'revenue', 'progress'].forEach(k => { if (updated[k] !== undefined) updated[k] = Number(updated[k] || 0); });
                    if (updated.expense !== undefined || updated.revenue !== undefined) {
                        const expenseV = updated.expense !== undefined ? updated.expense : p.expense || 0;
                        const revenueV = updated.revenue !== undefined ? updated.revenue : p.revenue || 0;
                        updated.profit = revenueV - expenseV;
                    }
                    const ref = doc(db, 'projects', p.id);
                    try {
                        if (action === 'save') {
                            await updateDoc(ref, updated);
                        } else if (action === 'complete') {
                            await updateDoc(ref, { status: 'completed', progress: 100 });
                        } else if (action === 'delete') {
                            await deleteDoc(ref);
                        }
                    } catch (e) { console.error('project action error:', e); }
                });

                projectsList.appendChild(card);
            });
            projectsCount.textContent = String(count);
            updateAnalytics(list);
        }

        onSnapshot(query(collection(db, 'projects'), orderBy('createdAt', 'desc')), (snap) => {
            projectsList.innerHTML = '';
            latestProjects = [];
            snap.forEach((docSnap) => { latestProjects.push({ id: docSnap.id, ...docSnap.data() }); });
            renderProjects(latestProjects);
        });

        // Search/filter
        projectSearch.addEventListener('input', () => {
            const q = projectSearch.value.trim().toLowerCase();
            if (!q) return renderProjects(latestProjects);
            const filtered = latestProjects.filter(p => {
                return (p.name || '').toLowerCase().includes(q) || (p.status || '').toLowerCase().includes(q);
            });
            renderProjects(filtered);
        });
        clearSearch.addEventListener('click', () => { projectSearch.value = ''; renderProjects(latestProjects); });

        // ------------------------------
        // Goals
        // ------------------------------
        const goalText = document.getElementById('goalText');
        const addGoalBtn = document.getElementById('addGoalBtn');
        const goalsList = document.getElementById('goalsList');
        // extend goals with status + priority
        const GOAL_STATUSES = ['pending', 'in_progress', 'achieved'];

        addGoalBtn.addEventListener('click', async () => {
            const text = goalText.value.trim();
            if (!text) return;
            try {
                await addDoc(collection(db, 'goals'), { text, status: 'pending', priority: 2, createdAt: serverTimestamp() });
                goalText.value = '';
            } catch (e) { console.error('addGoal error:', e); }
        });

        onSnapshot(query(collection(db, 'goals'), orderBy('createdAt', 'desc')), (snap) => {
            goalsList.innerHTML = '';
            snap.forEach((d) => {
                const g = { id: d.id, ...d.data() };
                const li = document.createElement('li');
                li.style.display = 'flex';
                li.style.alignItems = 'center';
                li.style.gap = '10px';
                li.style.background = '#0e0e12';
                li.style.border = '1px solid #202028';
                li.style.borderRadius = '12px';
                li.style.padding = '10px 12px';
                li.innerHTML = `
            <span style="flex:1;">${escapeHtml(g.text || '')}</span>
            <select class="inline-input" style="width:140px;" data-k="status">
              ${GOAL_STATUSES.map(s => `<option value="${s}" ${g.status === s ? 'selected' : ''}>${s.replace('_', ' ')}</option>`).join('')}
            </select>
            <select class="inline-input" style="width:120px;" data-k="priority">
              <option value="1" ${String(g.priority) === '1' ? 'selected' : ''}>Low</option>
              <option value="2" ${String(g.priority) === '2' ? 'selected' : ''}>Medium</option>
              <option value="3" ${String(g.priority) === '3' ? 'selected' : ''}>High</option>
            </select>
            <button class="btn ghost" data-action="save">Save</button>
            <button class="btn ghost" data-action="delete">Delete</button>
          `;
                li.addEventListener('click', async (ev) => {
                    const t = ev.target; if (!(t instanceof HTMLElement)) return;
                    const action = t.getAttribute('data-action');
                    if (!action) return;
                    const statusEl = /** @type {HTMLSelectElement} */(li.querySelector('[data-k="status"]'));
                    const prioEl = /** @type {HTMLSelectElement} */(li.querySelector('[data-k="priority"]'));
                    try {
                        if (action === 'save') await updateDoc(doc(db, 'goals', g.id), { status: statusEl.value, priority: Number(prioEl.value) });
                        else if (action === 'delete') await deleteDoc(doc(db, 'goals', g.id));
                    } catch (e) { console.error('goal action error:', e); }
                });
                goalsList.appendChild(li);
            });
        });

        // ------------------------------
        // Developers
        // ------------------------------
        const devName = document.getElementById('devName');
        const devRole = document.getElementById('devRole');
        const devContact = document.getElementById('devContact');
        const devSkills = document.getElementById('devSkills');
        const devNotes = document.getElementById('devNotes');
        const addDevBtn = document.getElementById('addDevBtn');
        const devsList = document.getElementById('devsList');
        const devsCount = document.getElementById('devsCount');
        const addDevMsg = document.getElementById('addDevMsg');

        addDevBtn.addEventListener('click', async () => {
            const name = devName.value.trim();
            const role = devRole.value.trim();
            const contact = devContact.value.trim();
            const skills = devSkills.value.trim();
            const notes = devNotes.value.trim();
            if (!name) { flash(addDevMsg, 'Enter a name', true); return; }
            try {
                await addDoc(collection(db, 'developers'), { name, role, contact, skills, notes, createdAt: serverTimestamp() });
                devName.value = ''; devRole.value = ''; devContact.value = ''; devSkills.value = ''; devNotes.value = '';
                flash(addDevMsg, 'Developer added.');
            } catch (e) { console.error('addDeveloper error:', e); flash(addDevMsg, e && e.message ? e.message : 'Error adding developer', true); }
        });

        onSnapshot(query(collection(db, 'developers'), orderBy('createdAt', 'desc')), (snap) => {
            devsList.innerHTML = '';
            let count = 0;
            snap.forEach((d) => {
                count += 1;
                const dev = { id: d.id, ...d.data() };
                const c = document.createElement('div');
                c.className = 'item';
                c.innerHTML = `
            <h4 class="mono">${escapeHtml(dev.name || '')}</h4>
            <input class="inline-input" data-k="name" placeholder="Name" value="${escapeAttr(dev.name || '')}" />
            <div style="display:grid; grid-template-columns: repeat(12, 1fr); gap:8px;">
              <input class="inline-input" style="grid-column: span 6;" data-k="role" placeholder="Role" value="${escapeAttr(dev.role || '')}" />
              <input class="inline-input" style="grid-column: span 6;" data-k="contact" placeholder="Contact" value="${escapeAttr(dev.contact || '')}" />
            </div>
            <input class="inline-input" data-k="skills" placeholder="Skills" value="${escapeAttr(dev.skills || '')}" />
            <input class="inline-input" data-k="notes" placeholder="Notes" value="${escapeAttr(dev.notes || '')}" />
            <div style="display:flex; gap:8px; margin-top:8px;">
              <button class="btn" data-action="save">Save</button>
              <button class="btn danger" data-action="delete">Delete</button>
            </div>
          `;
                c.addEventListener('click', async (ev) => {
                    const t = ev.target; if (!(t instanceof HTMLElement)) return;
                    const action = t.getAttribute('data-action'); if (!action) return;
                    const inputs = /** @type {NodeListOf<HTMLInputElement>} */(c.querySelectorAll('.inline-input'));
                    const updated = {}; inputs.forEach((el) => { const k = el.getAttribute('data-k'); if (!k) return; updated[k] = el.value; });
                    try {
                        const ref = doc(db, 'developers', dev.id);
                        if (action === 'save') await updateDoc(ref, updated);
                        else if (action === 'delete') await deleteDoc(ref);
                    } catch (e) { console.error('developer action error:', e); }
                });
                devsList.appendChild(c);
            });
            devsCount.textContent = String(count);
        });

        // ------------------------------
        // Utilities
        // ------------------------------
        function flash(el, text, isError = false) {
            el.textContent = text; el.style.color = isError ? 'var(--danger)' : 'var(--muted)';
            el.style.opacity = '1';
            setTimeout(() => { el.style.transition = 'opacity .6s ease'; el.style.opacity = '0'; }, 1400);
        }

        function escapeHtml(str) {
            return String(str).replaceAll('&', '&amp;').replaceAll('<', '&lt;').replaceAll('>', '&gt;');
        }
        function escapeAttr(str) {
            return String(str).replaceAll('&', '&amp;').replaceAll('"', '&quot;');
        }

        // Simple analytics text block
        const analyticsText = document.getElementById('analyticsText');
        function updateAnalytics(list) {
            const total = list.length;
            const completed = list.filter(p => p.status === 'completed').length;
            const ongoing = total - completed;
            const totalBudget = list.reduce((s, p) => s + Number(p.budget || 0), 0);
            const totalExpense = list.reduce((s, p) => s + Number(p.expense || 0), 0);
            const totalRevenue = list.reduce((s, p) => s + Number(p.revenue || 0), 0);
            const totalProfit = totalRevenue - totalExpense;
            analyticsText.innerHTML = `
          <span>Projects: ${total} (Ongoing: ${ongoing}, Completed: ${completed})</span>
          <span>Budget: ₹${totalBudget.toLocaleString('en-IN')}</span>
          <span>Expense: ₹${totalExpense.toLocaleString('en-IN')}</span>
          <span>Revenue: ₹${totalRevenue.toLocaleString('en-IN')}</span>
          <span>Profit: ₹${totalProfit.toLocaleString('en-IN')}</span>
        `;
        }

        // Notes / announcements
        const noteText = document.getElementById('noteText');
        const addNoteBtn = document.getElementById('addNoteBtn');
        const notesList = document.getElementById('notesList');
        addNoteBtn?.addEventListener('click', async () => {
            const text = noteText.value.trim(); if (!text) return;
            try { await addDoc(collection(db, 'notes'), { text, createdAt: serverTimestamp() }); noteText.value = ''; } catch (e) { console.error('addNote error:', e); }
        });
        onSnapshot(query(collection(db, 'notes'), orderBy('createdAt', 'desc')), (snap) => {
            notesList.innerHTML = '';
            snap.forEach(d => {
                const n = { id: d.id, ...d.data() };
                const li = document.createElement('li');
                li.style.display = 'flex'; li.style.gap = '10px'; li.style.alignItems = 'center';
                li.style.border = '1px solid #202028'; li.style.background = '#0e0e12'; li.style.borderRadius = '12px'; li.style.padding = '10px 12px';
                li.innerHTML = `<span style="flex:1;">${escapeHtml(n.text || '')}</span><button class="btn ghost" data-action="delete">Delete</button>`;
                li.addEventListener('click', async (ev) => { const t = ev.target; if (!(t instanceof HTMLElement)) return; if (t.getAttribute('data-action') === 'delete') { try { await deleteDoc(doc(db, 'notes', n.id)); } catch (e) { console.error('deleteNote error:', e); } } });
                notesList.appendChild(li);
            });
        });
    </script>
</body>

</html>